var blogApp=angular.module("blogApp",["ngRoute","ngCookies","chieffancypants.loadingBar"]);angular.module("blogApp").config(["$routeProvider",function(e){e.when("/",{templateUrl:"login/login",controller:"loginCtrl",title:"Login"}),e.when("/Login",{templateUrl:"login/login",controller:"loginCtrl",title:"Login"}),e.when("/Register",{templateUrl:"login/register",controller:"registerCtrl",title:"Register"}),e.when("/Home",{templateUrl:"home/dashboard",controller:"homeCtrl",title:"Home",resolve:{checkLoggedIn:checkLoggedIn}}),e.when("/Blog",{templateUrl:"blogs/blogs",controller:"blogCtrl",title:"Blog",resolve:{checkLoggedIn:checkLoggedIn}}),e.when("/Blog/:blogid",{templateUrl:"blogs/getblog",controller:"getblogCtrl",title:"Blog",resolve:{checkLoggedIn:checkLoggedIn}}),e.when("/Logout",{resolve:{Logout:Logout}})}]),angular.module("blogApp").run(["$rootScope",function(e){e.$on("$routeChangeStart",function(){e.stateIsLoading=!0}),e.$on("$routeChangeSuccess",function(o,t,l){t.hasOwnProperty("$$route")&&(e.title=t.$$route.title),e.stateIsLoading=!1})}]);var checkLoggedIn=["$q","$http","$location","welcomeservice",function(e,o,t,l){var n=e.defer();return o.get("/api/loggedin").success(function(e){"0"!=e?(l.setObject(e),n.resolve()):(l.clear(),n.reject(),t.url("/Login"))}),n.promise}],Logout=["$q","$http","$location","welcomeservice",function(e,o,t,l){var n=e.defer();return o.get("/api/logout").success(function(e){l.clear(),n.reject(),t.url("/Login")}),n.promise}];angular.module("blogApp").factory("blogservice",["$http",function(e){var o={};return o.userregister=function(o){return e.post("/api/users",o)},o.userlogin=function(o){return e.post("/api/login",o)},o.getotherblog=function(o){return e.get("/api/blogs/other/"+o)},o.getblogbyuserid=function(o){return e.get("/api/blogs/user/"+o)},o.getblogbyblogid=function(o){return e.get("/api/blogs/blog/"+o)},o.saveblog=function(o){return e.post("/api/blogs",o)},o.addcomment=function(o){return e.post("/api/comments",o)},o}]),angular.module("blogApp").service("welcomeservice",["$cookies",function(e){return{setObject:function(o){e.putObject("autharray",o)},getObject:function(){return e.getObject("autharray")},clear:function(){e.remove("autharray")}}}]),angular.module("blogApp").controller("loginCtrl",["$rootScope","$scope","$location","blogservice",function(e,o,t,l){e.showwelcome=!1,o.loginobj={},o.regmessage="",o.failedmsg="",o.login=function(e){o.regmessage="",o.failedmsg="",l.userlogin(o.loginobj).then(function(e){"success"==e.data?(o.loginobj={},t.url("/Home")):(o.loginobj.password="",o.regmessage="failed",o.failedmsg=e.data)},function(e){console.log(e),o.loginobj={},o.regmessage="failed",o.failedmsg=e.statusText})}}]),angular.module("blogApp").controller("registerCtrl",["$rootScope","$scope","blogservice",function(e,o,t){e.showwelcome=!1,o.registerobj={},o.regmessage="",o.register=function(e){t.userregister(o.registerobj).then(function(e){"success"==e.data?(o.registerobj={},o.regmessage="success"):o.regmessage="failed"})}}]),angular.module("blogApp").controller("homeCtrl",["$rootScope","$scope","blogservice","welcomeservice",function(e,o,t,l){o.blogs=[],o.logindata=l.getObject(),e.showwelcome=!0,e.username=o.logindata.username,o.getotherblogs=function(){t.getotherblog(o.logindata._id).then(function(e){o.blogs=e.data})},o.getotherblogs()}]),angular.module("blogApp").controller("blogCtrl",["$rootScope","$scope","blogservice","welcomeservice",function(e,o,t,l){o.blog={},o.blogs=[],o.logindata=l.getObject(),e.showwelcome=!0,e.username=o.logindata.username,o.getblogbyuser=function(){t.getblogbyuserid(o.logindata._id).then(function(e){o.blogs=e.data})},o.addblog=function(){o.blog.createdby=o.logindata._id,t.saveblog(o.blog).then(function(e){o.blog={},o.getblogbyuser()})},o.getblogbyuser()}]),angular.module("blogApp").controller("getblogCtrl",["$rootScope","$scope","$routeParams","blogservice","welcomeservice",function(e,o,t,l,n){o.blog={},o.logindata=n.getObject(),e.showwelcome=!0,e.username=o.logindata.username,o.getblogbyid=function(e){l.getblogbyblogid(e).then(function(e){console.log(e.data),o.blog=e.data})},o.addcomment=function(){o.commentmodel={comment:o.blogcomment,commentby:o.logindata._id,blogid:t.blogid},l.addcomment(o.commentmodel).then(function(e){o.blog=e.data,o.blogcomment=""})},o.getblogbyid(t.blogid)}]);