var blogApp=angular.module("blogApp",["ngRoute","ngCookies"]);angular.module("blogApp").config(["$routeProvider",function(e){e.when("/",{templateUrl:"login/login",controller:"loginCtrl"}),e.when("/Login",{templateUrl:"login/login",controller:"loginCtrl"}),e.when("/Register",{templateUrl:"login/register",controller:"registerCtrl"}),e.when("/Blog",{templateUrl:"blog/getblog",controller:"blogCtrl",resolve:{checkLoggedIn:checkLoggedIn}}),e.when("/Logout",{resolve:{Logout:Logout}})}]);var checkLoggedIn=["$q","$http","$location","welcomeservice",function(e,o,r,l){var t=e.defer();return o.get("/api/loggedin").success(function(e){"0"!=e?(l.setObject(e),t.resolve()):(l.clear(),t.reject(),r.url("/Login"))}),t.promise}],Logout=["$q","$http","$location","welcomeservice",function(e,o,r,l){var t=e.defer();return o.get("/api/logout").success(function(e){l.clear(),t.reject(),r.url("/Login")}),t.promise}];angular.module("blogApp").factory("blogservice",["$http",function(e){var o={};return o.userregister=function(o){return e.post("/api/users",o)},o.userlogin=function(o){return e.post("/api/login",o)},o.saveblog=function(o){return e.post("/api/blogs",o)},o}]),angular.module("blogApp").service("welcomeservice",["$cookies",function(e){return{setObject:function(o){e.putObject("autharray",o)},getObject:function(){return e.getObject("autharray")},clear:function(){e.remove("autharray")}}}]),angular.module("blogApp").controller("loginCtrl",["$rootScope","$scope","$location","blogservice",function(e,o,r,l){e.showwelcome=!1,o.loginobj={},o.regmessage="",o.failedmsg="",o.login=function(e){o.regmessage="",o.failedmsg="",l.userlogin(o.loginobj).then(function(e){"success"==e.data?(o.loginobj={},r.url("/Blog")):(o.loginobj.password="",o.regmessage="failed",o.failedmsg=e.data)},function(e){console.log(e),o.loginobj={},o.regmessage="failed",o.failedmsg=e.statusText})}}]),angular.module("blogApp").controller("registerCtrl",["$rootScope","$scope","blogservice",function(e,o,r){e.showwelcome=!1,o.registerobj={},o.regmessage="",o.register=function(e){r.userregister(o.registerobj).then(function(e){"success"==e.data?(o.registerobj={},o.regmessage="success"):o.regmessage="failed"})}}]),angular.module("blogApp").controller("blogCtrl",["$rootScope","$scope","blogservice","welcomeservice",function(e,o,r,l){o.logindata=l.getObject(),e.showwelcome=!0,e.username=o.logindata.username,o.addblog=function(){o.blog={},o.blog.blogheading="Test Blog",o.blog.blogcontent="Hi welcome to my blog",o.blog.createdby=o.logindata._id,r.saveblog(o.blog).then(function(){})}}]);