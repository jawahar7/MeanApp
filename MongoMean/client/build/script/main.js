var blogApp=angular.module("blogApp",["ngRoute","ngCookies"]);angular.module("blogApp").config(["$routeProvider",function(e){e.when("/",{templateUrl:"login/login",controller:"loginCtrl"}),e.when("/Login",{templateUrl:"login/login",controller:"loginCtrl"}),e.when("/Register",{templateUrl:"login/register",controller:"registerCtrl"}),e.when("/Home",{templateUrl:"home/dashboard",controller:"homeCtrl",resolve:{checkLoggedIn:checkLoggedIn}}),e.when("/Blog",{templateUrl:"blogs/blogs",controller:"blogCtrl",resolve:{checkLoggedIn:checkLoggedIn}}),e.when("/Blog/:blogid",{templateUrl:"blogs/getblog",controller:"getblogCtrl",resolve:{checkLoggedIn:checkLoggedIn}}),e.when("/Logout",{resolve:{Logout:Logout}})}]);var checkLoggedIn=["$q","$http","$location","welcomeservice",function(e,o,l,t){var g=e.defer();return o.get("/api/loggedin").success(function(e){"0"!=e?(t.setObject(e),g.resolve()):(t.clear(),g.reject(),l.url("/Login"))}),g.promise}],Logout=["$q","$http","$location","welcomeservice",function(e,o,l,t){var g=e.defer();return o.get("/api/logout").success(function(e){t.clear(),g.reject(),l.url("/Login")}),g.promise}];angular.module("blogApp").factory("blogservice",["$http",function(e){var o={};return o.userregister=function(o){return e.post("/api/users",o)},o.userlogin=function(o){return e.post("/api/login",o)},o.getotherblog=function(o){return e.get("/api/blogs/other/"+o)},o.getblogbyuserid=function(o){return e.get("/api/blogs/user/"+o)},o.getblogbyblogid=function(o){return e.get("/api/blogs/blog/"+o)},o.saveblog=function(o){return e.post("/api/blogs",o)},o}]),angular.module("blogApp").service("welcomeservice",["$cookies",function(e){return{setObject:function(o){e.putObject("autharray",o)},getObject:function(){return e.getObject("autharray")},clear:function(){e.remove("autharray")}}}]),angular.module("blogApp").controller("loginCtrl",["$rootScope","$scope","$location","blogservice",function(e,o,l,t){e.showwelcome=!1,o.loginobj={},o.regmessage="",o.failedmsg="",o.login=function(e){o.regmessage="",o.failedmsg="",t.userlogin(o.loginobj).then(function(e){"success"==e.data?(o.loginobj={},l.url("/Home")):(o.loginobj.password="",o.regmessage="failed",o.failedmsg=e.data)},function(e){console.log(e),o.loginobj={},o.regmessage="failed",o.failedmsg=e.statusText})}}]),angular.module("blogApp").controller("registerCtrl",["$rootScope","$scope","blogservice",function(e,o,l){e.showwelcome=!1,o.registerobj={},o.regmessage="",o.register=function(e){l.userregister(o.registerobj).then(function(e){"success"==e.data?(o.registerobj={},o.regmessage="success"):o.regmessage="failed"})}}]),angular.module("blogApp").controller("homeCtrl",["$rootScope","$scope","blogservice","welcomeservice",function(e,o,l,t){o.blogs=[],o.logindata=t.getObject(),e.showwelcome=!0,e.username=o.logindata.username,o.getotherblogs=function(){l.getotherblog(o.logindata._id).then(function(e){o.blogs=e.data})},o.getotherblogs()}]),angular.module("blogApp").controller("blogCtrl",["$rootScope","$scope","blogservice","welcomeservice",function(e,o,l,t){o.blog={},o.blogs=[],o.logindata=t.getObject(),e.showwelcome=!0,e.username=o.logindata.username,o.getblogbyuser=function(){l.getblogbyuserid(o.logindata._id).then(function(e){o.blogs=e.data})},o.addblog=function(){o.blog.createdby=o.logindata._id,l.saveblog(o.blog).then(function(e){o.blog={},o.getblogbyuser()})},o.getblogbyuser()}]),angular.module("blogApp").controller("getblogCtrl",["$rootScope","$scope","$routeParams","blogservice","welcomeservice",function(e,o,l,t,g){o.blog={},o.logindata=g.getObject(),e.showwelcome=!0,e.username=o.logindata.username,console.log(l.blogid),o.getblogbyid=function(e){t.getblogbyblogid(e).then(function(e){o.blog=e.data})},o.getblogbyid(l.blogid)}]);